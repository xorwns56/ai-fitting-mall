# ===========================================
# Prometheus 설정 파일
# Spring Boot Actuator 메트릭 수집 설정
# ===========================================

# 전역 설정
global:
  scrape_interval: 15s      # 메트릭 수집 주기 (15초마다 각 타겟에서 데이터 가져옴)
  evaluation_interval: 15s  # 알림 규칙 평가 주기

# 수집 대상 설정
scrape_configs:
  # -----------------------------------------
  # Prometheus 자체 모니터링
  # Prometheus 서버의 상태를 자기 자신이 수집
  # -----------------------------------------
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']  # Prometheus 자체 메트릭

  # -----------------------------------------
  # API Gateway (8080)
  # 모든 요청이 거쳐가므로 전체 트래픽 파악 가능
  # -----------------------------------------
  - job_name: 'gateway-service'
    metrics_path: '/actuator/prometheus'  # Spring Boot Actuator Prometheus 엔드포인트
    static_configs:
      - targets: ['host.docker.internal:8080']  # Docker에서 호스트 접근 시 사용하는 주소

  # -----------------------------------------
  # User Service (8081)
  # 사용자 인증/관리 관련 메트릭
  # -----------------------------------------
  - job_name: 'user-service'
    metrics_path: '/actuator/prometheus'
    static_configs:
      - targets: ['host.docker.internal:8081']

  # -----------------------------------------
  # Product Service (8082)
  # 상품 조회/관리 관련 메트릭
  # -----------------------------------------
  - job_name: 'product-service'
    metrics_path: '/actuator/prometheus'
    static_configs:
      - targets: ['host.docker.internal:8082']

  # -----------------------------------------
  # Fitting Service (8083)
  # AI 피팅 처리 관련 메트릭 (처리 시간 등 중요)
  # -----------------------------------------
  - job_name: 'fitting-service'
    metrics_path: '/actuator/prometheus'
    static_configs:
      - targets: ['host.docker.internal:8083']
